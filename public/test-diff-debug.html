<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æœ¬å·®å¼‚æ¯”è¾ƒè°ƒè¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        .test-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #555;
            margin-bottom: 20px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        /* å·¦å³åˆ†æ å¯¹æ¯”æ ·å¼ */
        .plan-comparison-side-by-side {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .side-by-side-diff,
        .side-by-side-array-diff {
            margin-bottom: 2rem;
        }
        
        .diff-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .diff-column {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            background: white;
        }
        
        .column-title {
            font-size: 0.875rem;
            font-weight: 600;
            margin: 0;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .column-title.removed {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .column-title.added {
            background: #f0fdf4;
            color: #16a34a;
        }
        
        .column-content {
            padding: 1rem;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        .diff-line {
            padding: 0.25rem 0;
            white-space: pre-wrap;
            word-break: break-word;
            border-radius: 0.25rem;
            margin: 0.125rem 0;
        }
        
        .diff-line.removed {
            background: #fef2f2;
            color: #dc2626;
            text-decoration: line-through;
            padding: 0.25rem 0.5rem;
        }
        
        .diff-line.added {
            background: #f0fdf4;
            color: #16a34a;
            padding: 0.25rem 0.5rem;
        }
        
        .diff-line.unchanged {
            color: #374151;
            padding: 0.25rem 0;
        }
        
        .diff-item {
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: 0.25rem;
            border-left: 3px solid;
        }
        
        .diff-item.removed {
            background: #fef2f2;
            border-left-color: #dc2626;
            color: #dc2626;
            text-decoration: line-through;
        }
        
        .diff-item.added {
            background: #f0fdf4;
            border-left-color: #16a34a;
            color: #16a34a;
        }
        
        .diff-item.unchanged {
            background: #f9fafb;
            border-left-color: #6b7280;
            color: #374151;
        }
        
        .comparison-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            background: white;
        }
        
        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .debug-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-family: monospace;
            font-size: 0.875rem;
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            cursor: pointer;
            margin: 0.5rem;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ–‡æœ¬å·®å¼‚æ¯”è¾ƒè°ƒè¯•å·¥å…·</h1>
        
        <div class="test-section">
            <div class="test-title">ğŸ”§ è°ƒè¯•ä¿¡æ¯</div>
            <div class="debug-info" id="debugInfo">
                ç‚¹å‡»æµ‹è¯•æŒ‰é’®æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯...
            </div>
            <button class="test-button" onclick="testTextDiff()">æµ‹è¯•æ–‡æœ¬å·®å¼‚</button>
            <button class="test-button" onclick="testArrayDiff()">æµ‹è¯•æ•°ç»„å·®å¼‚</button>
            <button class="test-button" onclick="testPlanComparison()">æµ‹è¯•æ–¹æ¡ˆå¯¹æ¯”</button>
        </div>
        
        <div class="test-section">
            <div class="test-title">ğŸ“ æµ‹è¯•ç»“æœ</div>
            <div id="testResult">
                æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...
            </div>
        </div>
    </div>

    <script>
        // ç®€å•çš„æ–‡æœ¬å·®å¼‚æ¯”è¾ƒå‡½æ•°
        function compareText(oldText, newText) {
            if (!oldText && !newText) return { added: [], removed: [], unchanged: [] }
            if (!oldText) return { added: [newText], removed: [], unchanged: [] }
            if (!newText) return { added: [], removed: [oldText], unchanged: [] }
            
            // å°†æ–‡æœ¬æŒ‰è¡Œåˆ†å‰²
            const oldLines = oldText.split('\n')
            const newLines = newText.split('\n')
            
            const result = {
                added: [],
                removed: [],
                unchanged: []
            }
            
            // ç®€å•çš„è¡Œçº§æ¯”è¾ƒ
            const oldSet = new Set(oldLines)
            const newSet = new Set(newLines)
            
            // æ‰¾å‡ºæ–°å¢çš„è¡Œ
            for (const line of newLines) {
                if (!oldSet.has(line)) {
                    result.added.push(line)
                }
            }
            
            // æ‰¾å‡ºåˆ é™¤çš„è¡Œ
            for (const line of oldLines) {
                if (!newSet.has(line)) {
                    result.removed.push(line)
                }
            }
            
            // æ‰¾å‡ºä¿æŒä¸å˜çš„è¡Œ
            for (const line of oldLines) {
                if (newSet.has(line)) {
                    result.unchanged.push(line)
                }
            }
            
            return result
        }

        // æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ•°ç»„
        function compareArrays(oldArray, newArray) {
            if (!oldArray && !newArray) return { added: [], removed: [], unchanged: [] }
            if (!oldArray) return { added: newArray, removed: [], unchanged: [] }
            if (!newArray) return { added: [], removed: oldArray, unchanged: [] }
            
            const result = {
                added: [],
                removed: [],
                unchanged: []
            }
            
            // å¤„ç†æ•°ç»„ä¸ºç©ºçš„æƒ…å†µ
            if (oldArray.length === 0 && newArray.length === 0) {
                return result
            }
            
            // å¦‚æœå…¶ä¸­ä¸€ä¸ªä¸ºç©ºï¼Œå¦ä¸€ä¸ªä¸ä¸ºç©ºï¼Œåˆ™å…¨éƒ¨ä¸ºæ–°å¢æˆ–åˆ é™¤
            if (oldArray.length === 0) {
                result.added = [...newArray]
                return result
            }
            
            if (newArray.length === 0) {
                result.removed = [...oldArray]
                return result
            }
            
            const oldSet = new Set(oldArray)
            const newSet = new Set(newArray)
            
            // æ‰¾å‡ºæ–°å¢çš„é¡¹ç›®
            for (const item of newArray) {
                if (!oldSet.has(item)) {
                    result.added.push(item)
                }
            }
            
            // æ‰¾å‡ºåˆ é™¤çš„é¡¹ç›®
            for (const item of oldArray) {
                if (!newSet.has(item)) {
                    result.removed.push(item)
                }
            }
            
            // æ‰¾å‡ºä¿æŒä¸å˜çš„é¡¹ç›®
            for (const item of oldArray) {
                if (newSet.has(item)) {
                    result.unchanged.push(item)
                }
            }
            
            return result
        }

        // è½¬ä¹‰HTMLå­—ç¬¦
        function escapeHtml(text) {
            const div = document.createElement('div')
            div.textContent = text
            return div.innerHTML
        }

        // ç”Ÿæˆå·¦å³åˆ†æ çš„æ–‡æœ¬å·®å¼‚HTML
        function generateSideBySideDiffHTML(oldText, newText) {
            const diff = compareText(oldText, newText)
            
            let html = '<div class="side-by-side-diff">'
            html += '<div class="diff-columns">'
            
            // å·¦ä¾§ï¼šåŸæ–‡
            html += '<div class="diff-column old-column">'
            html += '<h4 class="column-title removed">åŸæ–‡</h4>'
            html += '<div class="column-content">'
            
            // æ˜¾ç¤ºåˆ é™¤çš„å†…å®¹ï¼ˆçº¢è‰²ï¼‰
            if (diff.removed.length > 0) {
                diff.removed.forEach(line => {
                    html += `<div class="diff-line removed">${escapeHtml(line)}</div>`
                })
            }
            
            // æ˜¾ç¤ºä¿æŒä¸å˜çš„å†…å®¹
            if (diff.unchanged.length > 0) {
                diff.unchanged.forEach(line => {
                    html += `<div class="diff-line unchanged">${escapeHtml(line)}</div>`
                })
            }
            
            html += '</div></div>'
            
            // å³ä¾§ï¼šæ–°æ–‡
            html += '<div class="diff-column new-column">'
            html += '<h4 class="column-title added">è¿­ä»£å</h4>'
            html += '<div class="column-content">'
            
            // æ˜¾ç¤ºæ–°å¢çš„å†…å®¹ï¼ˆç»¿è‰²ï¼‰
            if (diff.added.length > 0) {
                diff.added.forEach(line => {
                    html += `<div class="diff-line added">${escapeHtml(line)}</div>`
                })
            }
            
            // æ˜¾ç¤ºä¿æŒä¸å˜çš„å†…å®¹
            if (diff.unchanged.length > 0) {
                diff.unchanged.forEach(line => {
                    html += `<div class="diff-line unchanged">${escapeHtml(line)}</div>`
                })
            }
            
            html += '</div></div>'
            
            html += '</div></div>'
            return html
        }

        // ç”Ÿæˆå·¦å³åˆ†æ çš„æ•°ç»„å·®å¼‚HTML
        function generateSideBySideArrayDiffHTML(oldArray, newArray, title = '') {
            const diff = compareArrays(oldArray, newArray)
            
            let html = `<div class="side-by-side-array-diff">`
            if (title) {
                html += `<h3 class="array-diff-title">${title}</h3>`
            }
            
            html += '<div class="diff-columns">'
            
            // å·¦ä¾§ï¼šåŸæ–‡
            html += '<div class="diff-column old-column">'
            html += '<h4 class="column-title removed">åŸæ–‡</h4>'
            html += '<div class="column-content">'
            
            // æ˜¾ç¤ºåˆ é™¤çš„é¡¹ç›®ï¼ˆçº¢è‰²ï¼‰
            if (diff.removed.length > 0) {
                diff.removed.forEach(item => {
                    html += `<div class="diff-item removed">${escapeHtml(item)}</div>`
                })
            }
            
            // æ˜¾ç¤ºä¿æŒä¸å˜çš„é¡¹ç›®
            if (diff.unchanged.length > 0) {
                diff.unchanged.forEach(item => {
                    html += `<div class="diff-item unchanged">${escapeHtml(item)}</div>`
                })
            }
            
            html += '</div></div>'
            
            // å³ä¾§ï¼šæ–°æ–‡
            html += '<div class="diff-column new-column">'
            html += '<h4 class="column-title added">è¿­ä»£å</h4>'
            html += '<div class="column-content">'
            
            // æ˜¾ç¤ºæ–°å¢çš„é¡¹ç›®ï¼ˆç»¿è‰²ï¼‰
            if (diff.added.length > 0) {
                diff.added.forEach(item => {
                    html += `<div class="diff-item added">${escapeHtml(item)}</div>`
                })
            }
            
            // æ˜¾ç¤ºä¿æŒä¸å˜çš„é¡¹ç›®
            if (diff.unchanged.length > 0) {
                diff.unchanged.forEach(item => {
                    html += `<div class="diff-item unchanged">${escapeHtml(item)}</div>`
                })
            }
            
            html += '</div></div>'
            
            html += '</div></div>'
            return html
        }

        // æµ‹è¯•æ–‡æœ¬å·®å¼‚
        function testTextDiff() {
            const oldText = `æ¢ç©¶aiå¯¹äººç±»è®°å¿† - å®Œæ•´è¿­ä»£ç‰ˆæœ¬
è¿™æ˜¯ç¬¬ä¸€è¡Œå†…å®¹
è¿™æ˜¯ç¬¬äºŒè¡Œå†…å®¹
è¿™æ˜¯ç¬¬ä¸‰è¡Œå†…å®¹`;

            const newText = `äººå·¥æ™ºèƒ½ä¸äººç±»è®°å¿†çš„å½±å“ç ”ç©¶
è¿™æ˜¯ç¬¬ä¸€è¡Œå†…å®¹
è¿™æ˜¯ä¿®æ”¹åçš„ç¬¬äºŒè¡Œ
è¿™æ˜¯ç¬¬ä¸‰è¡Œå†…å®¹
è¿™æ˜¯æ–°å¢çš„ç¬¬å››è¡Œ`;

            const diff = compareText(oldText, newText);
            
            document.getElementById('debugInfo').innerHTML = `
                <strong>æ–‡æœ¬å·®å¼‚æµ‹è¯•ç»“æœï¼š</strong><br>
                <strong>åŸæ–‡ï¼š</strong><br>${oldText.replace(/\n/g, '<br>')}<br><br>
                <strong>æ–°æ–‡ï¼š</strong><br>${newText.replace(/\n/g, '<br>')}<br><br>
                <strong>å·®å¼‚åˆ†æï¼š</strong><br>
                åˆ é™¤: ${diff.removed.length} è¡Œ<br>
                æ–°å¢: ${diff.added.length} è¡Œ<br>
                ä¿æŒä¸å˜: ${diff.unchanged.length} è¡Œ<br>
                <strong>åˆ é™¤å†…å®¹ï¼š</strong> ${JSON.stringify(diff.removed)}<br>
                <strong>æ–°å¢å†…å®¹ï¼š</strong> ${JSON.stringify(diff.added)}<br>
                <strong>ä¿æŒä¸å˜ï¼š</strong> ${JSON.stringify(diff.unchanged)}
            `;

            document.getElementById('testResult').innerHTML = generateSideBySideDiffHTML(oldText, newText);
        }

        // æµ‹è¯•æ•°ç»„å·®å¼‚
        function testArrayDiff() {
            const oldArray = [
                'H1: ç”¨æˆ·å¯¹äº§å“çš„æ»¡æ„åº¦ä¼šå½±å“è´­ä¹°æ„æ„¿',
                'H2: ä»·æ ¼æ•æ„Ÿåº¦åœ¨ä¸åŒå¹´é¾„ç»„ä¹‹é—´å­˜åœ¨å·®å¼‚'
            ];

            const newArray = [
                'H1: ç”¨æˆ·å¯¹äº§å“çš„æ»¡æ„åº¦ä¼šæ­£å‘å½±å“è´­ä¹°æ„æ„¿ï¼Œä¸”è¿™ç§å½±å“åœ¨é«˜ä»·æ ¼æ¡ä»¶ä¸‹æ›´ä¸ºæ˜¾è‘—',
                'H2: ä»·æ ¼æ•æ„Ÿåº¦åœ¨ä¸åŒå¹´é¾„ç»„ä¹‹é—´å­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼Œå¹´è½»ç”¨æˆ·æ›´å…³æ³¨ä»·æ ¼å› ç´ ',
                'H3: äº§å“ç±»å‹è°ƒèŠ‚ä»·æ ¼ä¸è´­ä¹°æ„æ„¿çš„å…³ç³»'
            ];

            const diff = compareArrays(oldArray, newArray);
            
            document.getElementById('debugInfo').innerHTML = `
                <strong>æ•°ç»„å·®å¼‚æµ‹è¯•ç»“æœï¼š</strong><br>
                <strong>åŸæ–‡æ•°ç»„ï¼š</strong> ${JSON.stringify(oldArray)}<br><br>
                <strong>æ–°æ–‡æ•°ç»„ï¼š</strong> ${JSON.stringify(newArray)}<br><br>
                <strong>å·®å¼‚åˆ†æï¼š</strong><br>
                åˆ é™¤: ${diff.removed.length} é¡¹<br>
                æ–°å¢: ${diff.added.length} é¡¹<br>
                ä¿æŒä¸å˜: ${diff.unchanged.length} é¡¹<br>
                <strong>åˆ é™¤å†…å®¹ï¼š</strong> ${JSON.stringify(diff.removed)}<br>
                <strong>æ–°å¢å†…å®¹ï¼š</strong> ${JSON.stringify(diff.added)}<br>
                <strong>ä¿æŒä¸å˜ï¼š</strong> ${JSON.stringify(diff.unchanged)}
            `;

            document.getElementById('testResult').innerHTML = generateSideBySideArrayDiffHTML(oldArray, newArray, 'ç ”ç©¶å‡è®¾');
        }

        // æµ‹è¯•æ–¹æ¡ˆå¯¹æ¯”
        function testPlanComparison() {
            const beforePlan = {
                title: 'æ¢ç©¶aiå¯¹äººç±»è®°å¿† - å®Œæ•´è¿­ä»£ç‰ˆæœ¬',
                hypotheses: [
                    'H1: AIç¼–è¾‘çš„å›¾åƒä¼šå¢åŠ é”™è¯¯è®°å¿†çš„å½¢æˆ',
                    'H2: å‚ä¸è€…å¯¹AIç¼–è¾‘å†…å®¹çš„ä¿¡å¿ƒæ°´å¹³ä¼šæ›´é«˜',
                    'H3: å¹´é¾„ä¼šå½±å“å¯¹AIç¼–è¾‘å†…å®¹çš„æ•æ„Ÿæ€§',
                    'H4: æ•™è‚²èƒŒæ™¯ä¼šè°ƒèŠ‚AIç¼–è¾‘å†…å®¹çš„å½±å“'
                ],
                experimentalDesign: 'é‡‡ç”¨ç»„é—´è®¾è®¡ï¼Œå‚ä¸è€…éšæœºåˆ†é…åˆ°AIç¼–è¾‘ç»„å’Œå¯¹ç…§ç»„ã€‚'
            };

            const afterPlan = {
                title: 'äººå·¥æ™ºèƒ½ä¸äººç±»è®°å¿†çš„å½±å“ç ”ç©¶',
                hypotheses: [
                    'æœ¬ç ”ç©¶æ—¨åœ¨æ¢è®¨äººå·¥æ™ºèƒ½ç¼–è¾‘å†…å®¹å¯¹äººç±»è®°å¿†çš„å½±å“ï¼Œç‰¹åˆ«å…³æ³¨é”™è¯¯è®°å¿†çš„å½¢æˆä¸ä¿¡å¿ƒã€‚æˆ‘ä»¬æå‡ºä»¥ä¸‹å‡è®¾ï¼Œä»¥æŒ‡å¯¼å®éªŒè®¾è®¡å’Œå®éªŒè®¾è®¡'
                ],
                experimentalDesign: 'é‡‡ç”¨ç»„é—´è®¾è®¡ï¼Œå‚ä¸è€…éšæœºåˆ†é…åˆ°AIç¼–è¾‘ç»„å’Œå¯¹ç…§ç»„ã€‚'
            };

            document.getElementById('debugInfo').innerHTML = `
                <strong>æ–¹æ¡ˆå¯¹æ¯”æµ‹è¯•ç»“æœï¼š</strong><br>
                <strong>åŸæ–‡æ–¹æ¡ˆï¼š</strong><br>
                æ ‡é¢˜: ${beforePlan.title}<br>
                å‡è®¾æ•°é‡: ${beforePlan.hypotheses.length}<br>
                å®éªŒè®¾è®¡: ${beforePlan.experimentalDesign}<br><br>
                <strong>æ–°æ–‡æ–¹æ¡ˆï¼š</strong><br>
                æ ‡é¢˜: ${afterPlan.title}<br>
                å‡è®¾æ•°é‡: ${afterPlan.hypotheses.length}<br>
                å®éªŒè®¾è®¡: ${afterPlan.experimentalDesign}
            `;

            let html = '<div class="plan-comparison-side-by-side">';
            
            // æ ‡é¢˜å¯¹æ¯”
            if (beforePlan.title !== afterPlan.title) {
                html += '<div class="comparison-section">';
                html += '<h3 class="section-title">æ–¹æ¡ˆæ ‡é¢˜</h3>';
                html += generateSideBySideDiffHTML(beforePlan.title || '', afterPlan.title || '');
                html += '</div>';
            }
            
            // ç ”ç©¶å‡è®¾å¯¹æ¯”
            const hypothesesDiff = compareArrays(beforePlan.hypotheses || [], afterPlan.hypotheses || []);
            if (hypothesesDiff.added.length > 0 || hypothesesDiff.removed.length > 0) {
                html += '<div class="comparison-section">';
                html += generateSideBySideArrayDiffHTML(beforePlan.hypotheses || [], afterPlan.hypotheses || [], 'ç ”ç©¶å‡è®¾');
                html += '</div>';
            }
            
            // å®éªŒè®¾è®¡å¯¹æ¯”
            if (beforePlan.experimentalDesign !== afterPlan.experimentalDesign) {
                html += '<div class="comparison-section">';
                html += '<h3 class="section-title">å®éªŒè®¾è®¡</h3>';
                html += generateSideBySideDiffHTML(beforePlan.experimentalDesign || '', afterPlan.experimentalDesign || '');
                html += '</div>';
            }
            
            html += '</div>';
            
            document.getElementById('testResult').innerHTML = html;
        }
    </script>
</body>
</html> 